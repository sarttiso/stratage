<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="stratage" href="api/modules.html" /><link rel="prev" title="StratAge" href="index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Toy Example for StratAge - stratage 1.1.0.post1.dev1+gc5f3bc7 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
  
  <script defer src="https://umami.ts-ht.com/script.js" data-website-id="0775ec1a-107e-4c73-ab7e-08325a4a5fac"></script>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">stratage 1.1.0.post1.dev1+gc5f3bc7 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">stratage 1.1.0.post1.dev1+gc5f3bc7 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Toy Example</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/modules.html">Module Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Module Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/stratage.html">stratage package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/toy-example.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="toy-example-for-stratage">
<h1>Toy Example for <code class="docutils literal notranslate"><span class="pre">StratAge</span></code><a class="headerlink" href="#toy-example-for-stratage" title="Link to this heading">¶</a></h1>
<p>This notebook presents the logic and operation of <code class="docutils literal notranslate"><span class="pre">StratAge</span></code> on an example with completely synthetic toy data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="kn">import</span> <span class="nn">stratage</span>
<span class="kn">from</span> <span class="nn">stratage.geochron</span> <span class="kn">import</span> <span class="n">Geochron</span>
<span class="kn">import</span> <span class="nn">pystrat</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="synthetic-stratigraphy">
<h2>Synthetic Stratigraphy<a class="headerlink" href="#synthetic-stratigraphy" title="Link to this heading">¶</a></h2>
<p>Here let’s fabricate a synthetic stratigraphy with five units and three geochronologic constraints. We also construct an age model in the <code class="docutils literal notranslate"><span class="pre">times</span></code> array, which contains the bottom and top ages for each unit. This is the true age model that <code class="docutils literal notranslate"><span class="pre">StratAge</span></code> will recover probabilistically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">units</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">2.7</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">],</span>
                  <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">]])</span> <span class="o">-</span> <span class="mf">4.2</span>

<span class="n">n_units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_contacts</span> <span class="o">=</span> <span class="n">n_units</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>Note that here we are using <code class="docutils literal notranslate"><span class="pre">pystrat</span></code> (<a class="reference external" href="https://github.com/yuempark/pystrat">github</a>) for visualizing the example stratigraphy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thicknesses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">facies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;sand&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">thicknesses</span><span class="p">))</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">pystrat</span><span class="o">.</span><span class="n">Style</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;sand&#39;</span><span class="p">]),</span> 
                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">252</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">130</span><span class="p">]])</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> 
                      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">pystrat</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">thicknesses</span><span class="p">,</span> <span class="n">facies</span><span class="p">)</span>
<span class="n">section</span><span class="o">.</span><span class="n">shift_heights</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>   <span class="c1"># make same y axis as heights</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">heights_ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">units</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">units</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="n">heights_ylim</span><span class="p">)</span>
<span class="n">section</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (cm)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4aeb8cb04d1376896dc452e78985e5c42e55344d021a343e2ac501a8d4ed74e5.png" src="_images/4aeb8cb04d1376896dc452e78985e5c42e55344d021a343e2ac501a8d4ed74e5.png" />
</div>
</div>
</section>
<section id="synthetic-geochronology">
<h2>Synthetic Geochronology<a class="headerlink" href="#synthetic-geochronology" title="Link to this heading">¶</a></h2>
<p>Create some temporal constraints within the core. Let’s just put one at the top and bottom, and then randomly distribute some throughout.</p>
<p>For now, let’s assume a constant uncertainty in temporal constraints. The “mean” values in time for each constraint will be sampled from normal distributions centered on the true values and with the same uncertainty specified below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># temporal uncertainty</span>
<span class="n">sig_t</span> <span class="o">=</span> <span class="mf">0.15</span>

<span class="c1"># number of constraints to include</span>
<span class="n">n_constraints</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">constraint_rvs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">constraint_heights</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># bottom (within first unit)</span>
<span class="n">constraint_rvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">sig_t</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">sig_t</span><span class="p">))</span>
<span class="n">constraint_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    
<span class="c1"># top (within top unit)</span>
<span class="n">constraint_rvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">sig_t</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">sig_t</span><span class="p">))</span>
<span class="n">constraint_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.9</span><span class="p">)</span>

<span class="c1"># 3rd constraint in middle</span>
<span class="n">constraint_rvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">sig_t</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">sig_t</span><span class="p">))</span>
<span class="n">constraint_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now visualize the true age model alongside the constraints and the experimental stratigraphy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">sig_t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">sig_t</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>

<span class="c1"># true age model</span>
<span class="n">t_true</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">age_depth</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
<span class="c1"># parameters for plotting pdfs</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.75</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">h</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lab</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">heights_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">heights_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">scale</span><span class="p">])</span>
<span class="n">section</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">+</span><span class="n">scale</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>

<span class="n">cur_h</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_true</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True age model&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_h</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;True age model&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_constraints</span><span class="p">):</span>
    <span class="n">cur_pdf</span> <span class="o">=</span> <span class="n">constraint_rvs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">t_plot</span><span class="p">)</span>
    <span class="c1"># only plot the part of the pdf that matters</span>
    <span class="n">idx_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cur_pdf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cur_pdf</span><span class="p">))</span> <span class="o">-</span> <span class="n">tol</span><span class="p">)</span>
    
    <span class="c1"># scale it to be visible</span>
    <span class="n">pdf_scale</span> <span class="o">=</span> <span class="n">scale</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cur_pdf</span><span class="p">[</span><span class="n">idx_pdf</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cur_pdf</span><span class="p">[</span><span class="n">idx_pdf</span><span class="p">]))</span>
    <span class="n">cur_pdf</span> <span class="o">=</span> <span class="n">constraint_heights</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdf_scale</span> <span class="o">*</span> <span class="n">cur_pdf</span>
    
    <span class="n">cur_h</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_plot</span><span class="p">[</span><span class="n">idx_pdf</span><span class="p">],</span> 
                             <span class="n">cur_pdf</span><span class="p">[</span><span class="n">idx_pdf</span><span class="p">],</span>
                               <span class="n">constraint_heights</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Geochronology&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_h</span><span class="p">)</span>
<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Geochronology&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">lab</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Schematic example&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2a39fe87e287d0fd684383b2d052d8df9e99359a39b4addf96f61e92fb869328.png" src="_images/2a39fe87e287d0fd684383b2d052d8df9e99359a39b4addf96f61e92fb869328.png" />
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Geochronologic constraints must occur within units and not on contacts. Because hiatus exists at contacts, there would be ambiguity as to whether the constraint dates the “top” or “bottom” of the hiatus.</p>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">stratage.geochron_height_check()</span></code> to ensure that the provided geochronologic constraints occur within the provided units and not on contacts. If nothing is returned, then we’re good to go!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stratage</span><span class="o">.</span><span class="n">geochron_height_check</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">constraint_heights</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For now, age models can only be constructed in between the outermost geochronologic constraints. The upper and lower most units must therefore be “trimmed” such that the provided constraints bookend the entire stratigraphy perfectly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">stratage.trim_units()</span></code> function performs this trimming, which is plotted below, comparing the original stratigraphy on the left with the trimmed stratigraphy on the right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">units_trim</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">trim_units</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">constraint_heights</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thicknesses_trim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">units_trim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

<span class="n">section_trim</span> <span class="o">=</span> <span class="n">pystrat</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">thicknesses_trim</span><span class="p">,</span> <span class="n">facies</span><span class="p">)</span>
<span class="n">section_trim</span><span class="o">.</span><span class="n">shift_heights</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">units_trim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>   <span class="c1"># make same y axis as heights</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">heights_ylim</span><span class="p">)</span>
<span class="n">section</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (cm)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="n">section_trim</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d0a680f40f651c799b6733fa10349b9eb3be7931b8166e513aa3b784bd1a6bde.png" src="_images/d0a680f40f651c799b6733fa10349b9eb3be7931b8166e513aa3b784bd1a6bde.png" />
</div>
</div>
</section>
<section id="the-stratage-geochron-class">
<h2>The <code class="docutils literal notranslate"><span class="pre">stratage.Geochron</span></code> Class<a class="headerlink" href="#the-stratage-geochron-class" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Geochron</span></code> object constructed below contains the geochronologic constraints and their heights. It requires representation of the constraints as random variables with a <code class="docutils literal notranslate"><span class="pre">scipy.stats.distribution</span></code>-like signature; minimally providing <code class="docutils literal notranslate"><span class="pre">.pdf()</span></code>, <code class="docutils literal notranslate"><span class="pre">.cdf()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.ppf()</span></code> methods. The way we defined the constraints above will work perfectly.</p>
<p>Instantiation of the <code class="docutils literal notranslate"><span class="pre">Geochron</span></code> object creates a time increment distribution for pairs of geochronologic constraints. Each time increment distribution encodes the probability density of elapsed time between the given pair of constraints. At this time, <code class="docutils literal notranslate"><span class="pre">Geochron</span></code> can create time increment distributions for all pairs of constraints (<code class="docutils literal notranslate"><span class="pre">StratAge.Geochron(neighbors='all')</span></code>), or it can create pairs a specified number of neighboring constraints (<code class="docutils literal notranslate"><span class="pre">StratAge.Geochron(neighbors=int)</span></code>). Using all pairs can dramatically increase run time; using a subset of neighboring pairs runs much faster and can yield similar results. In this case, with only three constraints and such a simple stratigraphy, the choice makes little difference.</p>
<p>For various reasons, the time increment distributions are evaluated numerically. The temporal resolution of the time increment distributions is set by two parameters: <code class="docutils literal notranslate"><span class="pre">nt</span></code> and <code class="docutils literal notranslate"><span class="pre">ndt</span></code>. The <code class="docutils literal notranslate"><span class="pre">nt</span></code> parameter specifies how many points to use in the evaluation of each constraint’s probability density, and the <code class="docutils literal notranslate"><span class="pre">ndt</span></code> parameter specifies how many points to use in the evaluation of the time increment distribution between two constraints (this evaluation uses the constraint probability densities).</p>
<p>Larger values create finer grids, but require longer computation, especially for larger numbers of constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geochron</span> <span class="o">=</span> <span class="n">Geochron</span><span class="p">(</span><span class="n">constraint_heights</span><span class="p">,</span> <span class="n">constraint_rvs</span><span class="p">,</span> <span class="n">nt</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">ndt</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">prob_threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "217878d50bc540a4ac4198b11947ea86", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Here we plot the time increment distributions using <code class="docutils literal notranslate"><span class="pre">Geochron.plot_increment_pdfs()</span></code>. The heights of the pairs of constraints for each time increment are labeled on the left side of the graph. From the principle of stratigraphic superposition, time increments are always positive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">geochron</span><span class="o">.</span><span class="n">plot_increment_pdfs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9c9804757e55a6b15e86bd5e6cdc2038e63d6c4c39ecbc791db0f9c9bc96c3ad.png" src="_images/9c9804757e55a6b15e86bd5e6cdc2038e63d6c4c39ecbc791db0f9c9bc96c3ad.png" />
</div>
</div>
</section>
<section id="least-squares-age-depth-modeling">
<h2>Least Squares Age-Depth Modeling<a class="headerlink" href="#least-squares-age-depth-modeling" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">geochron.model_weights()</span></code> function generates the weights for units and contacts for each pair of constraints. These weights identify which contacts and units occur within a given pair of constraints.</p>
<p>For contacts, the weights <span class="math notranslate nohighlight">\(\beta\)</span> are either 0 or 1, because contacts cannot be partially bound by constraints.</p>
<p>For units, the weights <span class="math notranslate nohighlight">\(\alpha\)</span> range from 0 to the thickness of the unit. A value equal to the thickness of the unit means that the given unit is completely bounded by a pair of constraints, i.e., no geochronologic constraint occurs within that unit. A value between 0 and the thickness of the unit means that for the given pair of constraints, one occurs within the unit, and the value of the weight quantifies the proportion of the unit that is bound between the constraints. This approach assumes a constant sedimentation rate for the portion of the unit that is partially bound by a constraint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">geochron</span><span class="o">.</span><span class="n">model_weights</span><span class="p">(</span><span class="n">units_trim</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;alpha:</span><span class="se">\n</span><span class="si">{</span><span class="n">alpha</span><span class="o">.</span><span class="n">T</span><span class="si">}</span><span class="se">\n</span><span class="s1">beta:</span><span class="se">\n</span><span class="si">{</span><span class="n">beta</span><span class="o">.</span><span class="n">T</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>alpha:
[[1.4 0.7 0.3 0.  0. ]
 [1.4 0.7 0.5 0.7 0.5]
 [0.  0.  0.2 0.7 0.5]]
beta:
[[1. 1. 0. 0.]
 [1. 1. 1. 1.]
 [0. 0. 1. 1.]]
</pre></div>
</div>
</div>
</div>
<p>The values of <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> form arrays that define a linear system with respect to time increments:</p>
<div class="math-wrapper amsmath docutils container" id="equation-ab5ab246-9aa2-431d-8a03-53e19d5f1df6">
<div class="amsmath math notranslate nohighlight" id="equation-ab5ab246-9aa2-431d-8a03-53e19d5f1df6">
<span class="eqno">(1)<a class="headerlink" href="#equation-ab5ab246-9aa2-431d-8a03-53e19d5f1df6" title="Permalink to this equation">¶</a></span>\[\begin{align}
\Delta \mathbf{T} &amp;= \alpha\,\mathbf{v}^{-1} + \beta\,\mathbf{t} \\
         &amp;= \begin{bmatrix}\alpha &amp; \beta\end{bmatrix}\,\begin{bmatrix} \mathbf{v}^{-1} \\ \mathbf{t} \end{bmatrix} \\
         &amp;= \mathbf{A}\,\mathbf{m}
\end{align}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\Delta \mathbf{T}\)</span> are the mean time increment values, <span class="math notranslate nohighlight">\(\mathbf{v}^{-1}\)</span> is <span class="math notranslate nohighlight">\(1/v_{i}\)</span> where <span class="math notranslate nohighlight">\(v_{i}\)</span> is the sedimentation rate for each bed, and <span class="math notranslate nohighlight">\(\mathbf{t}\)</span> are the hiatus durations between all beds.</p>
<p>As shown above, <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> can be concatenated to form <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>, and the system can be inverted via conventional least squares to solve for sedimentation rates <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> and hiatuses <span class="math notranslate nohighlight">\(\mathbf{t}\)</span>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">stratage.model_ls()</span></code> function performs this least squares inversion for the given units and geochronology.</p>
<p>This function returns least squares estimates for sedimentation rates and hiatuses, but together these only constitute a floating age model. To anchor the age model with the given geochronology, we can use <code class="docutils literal notranslate"><span class="pre">stratage.fit_floating_model()</span></code>, which returns an array of the best fittings absolute ages (<code class="docutils literal notranslate"><span class="pre">times_bdls</span></code>) for each height in <code class="docutils literal notranslate"><span class="pre">units_trim</span></code>, given the geochronology and modeled sedimentation rates and hiatuses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sed_rates_ls</span><span class="p">,</span> <span class="n">hiatuses_ls</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">model_ls</span><span class="p">(</span><span class="n">units_trim</span><span class="p">,</span> <span class="n">geochron</span><span class="p">)</span>

<span class="c1"># fit to constraints</span>
<span class="n">times_bdls</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">fit_floating_model</span><span class="p">(</span><span class="n">sed_rates_ls</span><span class="p">,</span> 
                                         <span class="n">hiatuses_ls</span><span class="p">,</span> 
                                         <span class="n">units_trim</span><span class="p">,</span> 
                                         <span class="n">geochron</span><span class="p">)</span>
<span class="n">t_bdls</span><span class="p">,</span> <span class="n">z_bdls</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">age_depth</span><span class="p">(</span><span class="n">units_trim</span><span class="p">,</span> <span class="n">times_bdls</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we converted the paired <code class="docutils literal notranslate"><span class="pre">units_trim</span></code> and <code class="docutils literal notranslate"><span class="pre">times_bdls</span></code> arrays into a more straightforward pair of age-depth sequences using <code class="docutils literal notranslate"><span class="pre">stratage.age_depth()</span></code>.</p>
<p>Now, we can plot the least squares age-depth model alongside the true model and the geochronology.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Now that we have created the <code class="docutils literal notranslate"><span class="pre">Geochron</span></code> object, we can use the <code class="docutils literal notranslate"><span class="pre">Geochron.plot_constraints()</span></code> function to facilitate plotting the probability density functions for the contraints in an age-depth space.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">sig_t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">sig_t</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>

<span class="c1"># true age model</span>
<span class="n">t_true</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">age_depth</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
<span class="c1"># parameters for plotting pdfs</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.75</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">heights_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">heights_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">scale</span><span class="p">])</span>
<span class="n">section</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">+</span><span class="n">scale</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_true</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True age model&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_bdls</span><span class="p">,</span> <span class="n">z_bdls</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Least squares age model&#39;</span><span class="p">)</span>

<span class="n">geochron</span><span class="o">.</span><span class="n">plot_constraints</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Synthetic constraints on true age model&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9c55bdb16e901570ba76dcf06f0831cf81f6a43ec5432be17ce4c104135ebf58.png" src="_images/9c55bdb16e901570ba76dcf06f0831cf81f6a43ec5432be17ce4c104135ebf58.png" />
</div>
</div>
<p>The least-squares model generates a reasonable age model that passes through the maximum likelihood values of the geochronologic constraints. <code class="docutils literal notranslate"><span class="pre">StratAge</span></code> uses the least squares solution as the initial model for the Markov Chain sampling.</p>
</section>
<section id="stratage-agemodel-bayesian-sampling">
<h2><code class="docutils literal notranslate"><span class="pre">StratAge.AgeModel</span></code> Bayesian Sampling<a class="headerlink" href="#stratage-agemodel-bayesian-sampling" title="Link to this heading">¶</a></h2>
<p>To set up the Bayesian model, we must specify prior distributions over sedimentation rates and hiatus durations. These distributions must be defined as functions that have the signature that is expected for the <code class="docutils literal notranslate"><span class="pre">dist</span></code> argument in <a class="reference external" href="https://www.pymc.io/projects/docs/en/v5.14.0/api/distributions/generated/pymc.CustomDist.html"><code class="docutils literal notranslate"><span class="pre">pymc.CustomDist(dist=dist)</span></code></a>, i.e. a signature of <code class="docutils literal notranslate"><span class="pre">dist(*dist_params,</span> <span class="pre">size)</span></code>. At this time, <code class="docutils literal notranslate"><span class="pre">StrageAge</span></code> cannot sample from hierarchical priors, meaning that prior distributions cannot require any <code class="docutils literal notranslate"><span class="pre">dist_params</span></code>. Therefore, the expected signature for prior distributions is just <code class="docutils literal notranslate"><span class="pre">prior(size)</span></code>.</p>
<p>Below, we use a log-normal prior over sedimentation rates, with a sigma of 1.2. We use a log-uniform prior over hiatus durations, ranging from 0.1 to 10. Notice that we are using <code class="docutils literal notranslate"><span class="pre">PyMC</span></code> distributions; any of the <code class="docutils literal notranslate"><span class="pre">PyMC</span></code> distributions should work analagously to what is shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># all units have same sed rate prior</span>
<span class="n">sed_rate_sigma</span> <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_units</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sed_rates_prior_fn</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pm</span><span class="o">.</span><span class="n">LogNormal</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sed_rate_sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">hiatuses_prior_fn</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">lower</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you wanted to have different parameter values for the priors on different beds or contacts, then you would just need to specify parameter arrays accordingly. For example, if we wanted the first bed to have a narrower prior distribution of sedimentation rates, we could have defined <code class="docutils literal notranslate"><span class="pre">sed_rate_sigma</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sed_rate_sigma</span> <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_units</span><span class="p">)</span>
<span class="n">sed_rate_sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
<p>Now that we have both prior distributions and the <code class="docutils literal notranslate"><span class="pre">Geochron</span></code> object with the probabilistic geochronologic constraints, we can instantiate the <code class="docutils literal notranslate"><span class="pre">stratage.AgeModel</span></code> class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agemodel</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">AgeModel</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">geochron</span><span class="p">,</span> <span class="n">sed_rates_prior_fn</span><span class="p">,</span> <span class="n">hiatuses_prior_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This class creates an object with a <code class="docutils literal notranslate"><span class="pre">pymc.Model</span></code> as an attribute, which we can visualize.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">model_to_graphviz</span><span class="p">(</span><span class="n">agemodel</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cf90c023e73fcc97bdbe2a1d383b673ac383247544cb8823ad08f38fe5f849d7.svg" src="_images/cf90c023e73fcc97bdbe2a1d383b673ac383247544cb8823ad08f38fe5f849d7.svg" />
</div>
</div>
<p>The model visualization shows that we have a random variable of sedimentation rates with a length of 5 and a random variable of hiatuses with a length of 4. The coordinates for these random variables are named “units” and “contacts,” and the sizes make sense with our simple stratigraphy that has 5 units and 4 contacts. We also see that these random varialbes are sampled according to <code class="docutils literal notranslate"><span class="pre">CustomDist</span></code> distributions, which correspond to the priors we defined above.</p>
<p>These random variables feed into a likelihood, which has a length of 3. This size reflects the 3 time increment distributions from the 3 combinations of geochronologic constraints, which were plotted above. The likelihood is based on the time increment distributions from the 3 pairs of constraints, defining the <code class="docutils literal notranslate"><span class="pre">CustomDist_likelihood</span></code> in the diagram above.</p>
<p>With the model defined above, we can use all the helpful and robust <code class="docutils literal notranslate"><span class="pre">PyMC</span></code> sampling tools. For example, we can sample from the prior distributions on sedimentation rates and hiatuses to see what sort of age models we would get.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_prior</span> <span class="o">=</span> <span class="n">agemodel</span><span class="o">.</span><span class="n">sample_prior</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling: [hiatuses, likelihood, sed_rates]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># true age model</span>
<span class="n">t_true</span><span class="p">,</span> <span class="n">z_true</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">age_depth</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
<span class="c1"># parameters for plotting pdfs</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>

<span class="c1"># true age model and constraints</span>
<span class="n">geochron</span><span class="o">.</span><span class="n">plot_constraints</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_true</span><span class="p">,</span> <span class="n">z_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;true age model&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># prior predictive models</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times_prior</span><span class="p">)):</span>
    <span class="n">cur_t</span><span class="p">,</span> <span class="n">cur_z</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">age_depth</span><span class="p">(</span><span class="n">units_trim</span><span class="p">,</span> <span class="n">times_prior</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cur_t</span><span class="p">,</span> <span class="n">cur_z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prior predictive age models&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8baf1cf74124b6179430246a6bf7649e9debcbe0aa0ebc80732425235ed12497.png" src="_images/8baf1cf74124b6179430246a6bf7649e9debcbe0aa0ebc80732425235ed12497.png" />
</div>
</div>
<p>The prior predictive models are not very good, as we can see in the figure above.</p>
<p>Let’s now actually sample the Bayesian age model. We do so by invoking <code class="docutils literal notranslate"><span class="pre">stratage.AgeModel.sample()</span></code>, which accepts keyword arguments that are passed to <code class="docutils literal notranslate"><span class="pre">pymc.sample()</span></code>.</p>
<p>At this time, sampling is restricted to the conventional Metropolis sampler.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draws</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">tune</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">n_chains</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">trace</span> <span class="o">=</span> <span class="n">agemodel</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="n">tune</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="n">n_chains</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Multiprocess sampling (4 chains in 4 jobs)
CompoundStep
&gt;Metropolis: [sed_rates]
&gt;Metropolis: [hiatuses]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fa03a8f9a6604b5c8c40efadb494bde3", "version_major": 2, "version_minor": 0}</script><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 2_000 tune and 5_000 draw iterations (8_000 + 20_000 draws total) took 83 seconds.
The rhat statistic is larger than 1.01 for some parameters. This indicates problems during sampling. See https://arxiv.org/abs/1903.08008 for details
The effective sample size per chain is smaller than 100 for some parameters.  A higher number is needed for reliable rhat and ess computation. See https://arxiv.org/abs/1903.08008 for details
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">arviz</span></code> to tabulate and plot helpful diagnostics for the chains that we sampled above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[autoreload of cutils_ext failed: Traceback (most recent call last):
  File &quot;c:\Users\XPS\miniforge3\Lib\site-packages\IPython\extensions\autoreload.py&quot;, line 276, in check
    superreload(m, reload, self.old_objects)
  File &quot;c:\Users\XPS\miniforge3\Lib\site-packages\IPython\extensions\autoreload.py&quot;, line 475, in superreload
    module = reload(module)
             ^^^^^^^^^^^^^^
  File &quot;c:\Users\XPS\miniforge3\Lib\importlib\__init__.py&quot;, line 130, in reload
    raise ModuleNotFoundError(f&quot;spec not found for the module {name!r}&quot;, name=name)
ModuleNotFoundError: spec not found for the module &#39;cutils_ext&#39;
]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>sed_rates[0]</th>
      <td>3.108</td>
      <td>2.847</td>
      <td>0.616</td>
      <td>7.667</td>
      <td>0.230</td>
      <td>0.163</td>
      <td>53.0</td>
      <td>29.0</td>
      <td>1.07</td>
    </tr>
    <tr>
      <th>sed_rates[1]</th>
      <td>1.698</td>
      <td>1.880</td>
      <td>0.351</td>
      <td>5.053</td>
      <td>0.160</td>
      <td>0.113</td>
      <td>59.0</td>
      <td>74.0</td>
      <td>1.03</td>
    </tr>
    <tr>
      <th>sed_rates[2]</th>
      <td>4.302</td>
      <td>7.592</td>
      <td>0.300</td>
      <td>11.833</td>
      <td>0.853</td>
      <td>0.617</td>
      <td>152.0</td>
      <td>111.0</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>sed_rates[3]</th>
      <td>6.889</td>
      <td>12.806</td>
      <td>1.021</td>
      <td>15.780</td>
      <td>1.455</td>
      <td>1.033</td>
      <td>273.0</td>
      <td>157.0</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>sed_rates[4]</th>
      <td>5.140</td>
      <td>5.354</td>
      <td>0.744</td>
      <td>14.158</td>
      <td>0.303</td>
      <td>0.225</td>
      <td>511.0</td>
      <td>457.0</td>
      <td>1.01</td>
    </tr>
    <tr>
      <th>hiatuses[0]</th>
      <td>0.516</td>
      <td>0.406</td>
      <td>0.100</td>
      <td>1.328</td>
      <td>0.043</td>
      <td>0.031</td>
      <td>105.0</td>
      <td>150.0</td>
      <td>1.03</td>
    </tr>
    <tr>
      <th>hiatuses[1]</th>
      <td>0.567</td>
      <td>0.452</td>
      <td>0.100</td>
      <td>1.445</td>
      <td>0.068</td>
      <td>0.048</td>
      <td>42.0</td>
      <td>177.0</td>
      <td>1.08</td>
    </tr>
    <tr>
      <th>hiatuses[2]</th>
      <td>0.207</td>
      <td>0.101</td>
      <td>0.100</td>
      <td>0.402</td>
      <td>0.003</td>
      <td>0.002</td>
      <td>1207.0</td>
      <td>1022.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>hiatuses[3]</th>
      <td>0.204</td>
      <td>0.101</td>
      <td>0.100</td>
      <td>0.392</td>
      <td>0.003</td>
      <td>0.002</td>
      <td>1123.0</td>
      <td>1212.0</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7c5144cfb1732e45b171b471bba170b448ae1cf403f861b8d218402dc38ce179.png" src="_images/7c5144cfb1732e45b171b471bba170b448ae1cf403f861b8d218402dc38ce179.png" />
</div>
</div>
</section>
<section id="generating-age-models">
<h2>Generating age models<a class="headerlink" href="#generating-age-models" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">StratAge.AgeModel</span></code> implements a Bayesian model to generate samples of sedimentation rates and hiatuses, but, as mentioned above, these only yield floating age models by themselves. Sedimentation rates and hiatuses in the trace generated by the PyMC sampling can be aligned to the geochronology using the <code class="docutils literal notranslate"><span class="pre">StratAge.AgeModel.trace2ages()</span></code> function.</p>
<p>This function returns posterior ages at requested stratigraphic heights. Note that this can take some time but is easily parallelized, so you can increase the <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> parameter to use more processes for large traces.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_h</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">units_trim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">units_trim</span><span class="p">),</span> <span class="n">n_h</span><span class="p">)</span>

<span class="n">t_posterior</span> <span class="o">=</span> <span class="n">agemodel</span><span class="o">.</span><span class="n">trace2ages</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "14aba08e6bc541bbb2da5c6da92d8e08", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ci_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">t_posterior</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ci_68</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">t_posterior</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can evaluate quantiles on the posterior age models and finally plot the Bayesian age model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># true age model</span>
<span class="n">t_true</span><span class="p">,</span> <span class="n">z_true</span> <span class="o">=</span> <span class="n">stratage</span><span class="o">.</span><span class="n">age_depth</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
<span class="c1"># parameters for plotting pdfs</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>

<span class="c1"># posterior predictive models</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ci_95</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">ci_95</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;gainsboro&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ci_68</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">ci_68</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">)</span>

<span class="c1"># true age model and constraints</span>
<span class="n">geochron</span><span class="o">.</span><span class="n">plot_constraints</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;bisque&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_true</span><span class="p">,</span> <span class="n">z_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;true age model&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Synthetic constraints on true age model&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a52e2634a3fee9c4f854a6144e2cdd3d2959672486286fd2b045f05c6ccd0f76.png" src="_images/a52e2634a3fee9c4f854a6144e2cdd3d2959672486286fd2b045f05c6ccd0f76.png" />
</div>
</div>
<p>Here we can see how the structure of the posterior age model is distinctly different from existing age modeling approaches. The envelope shows “jumpiness” that reflects the possibility of hiatus at bedding contacts. We see that the true age model is solidly within the 95% credible interval, which is great. We can also see that the posterior distribution in absolute time for the middle geochronologic constraint is reduced compared to it’s reported uncertainty. This reflects the incorporation of the prior information about sedimentation rates and hiatus durations, as well as stratigraphic superposition.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api/modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">stratage</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Adrian Tasistro-Hart
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Toy Example for <code class="docutils literal notranslate"><span class="pre">StratAge</span></code></a><ul>
<li><a class="reference internal" href="#synthetic-stratigraphy">Synthetic Stratigraphy</a></li>
<li><a class="reference internal" href="#synthetic-geochronology">Synthetic Geochronology</a></li>
<li><a class="reference internal" href="#the-stratage-geochron-class">The <code class="docutils literal notranslate"><span class="pre">stratage.Geochron</span></code> Class</a></li>
<li><a class="reference internal" href="#least-squares-age-depth-modeling">Least Squares Age-Depth Modeling</a></li>
<li><a class="reference internal" href="#stratage-agemodel-bayesian-sampling"><code class="docutils literal notranslate"><span class="pre">StratAge.AgeModel</span></code> Bayesian Sampling</a></li>
<li><a class="reference internal" href="#generating-age-models">Generating age models</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=e0dbd34f"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>